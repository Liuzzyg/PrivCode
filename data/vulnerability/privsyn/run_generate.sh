#!/bin/bash

MODEL_PATH="Qwen/Qwen2.5-Coder-1.5B"

MODEL_NAME=$(echo $MODEL_PATH | awk -F '/' '{print $NF}')

MAX_LAMBDAs=(100)
ALPHAs=(0.01)
DP_EPSILONs=(0.2 1 4 10)
DP_EPSILONs=(0.2 1)
DP_EPSILONs=(10)
DATA_SIZEs=(55500)

STEP=50    # main
# STEP=1000   # epsilon hyper-parameter


for DP_EPSILON in "${DP_EPSILONs[@]}"; do
    for MAX_LAMBDA in "${MAX_LAMBDAs[@]}"; do
        for DATA_SIZE in "${DATA_SIZEs[@]}"; do
            for ALPHA in "${ALPHAs[@]}"; do
                CKPT=".../checkpoints_codeonly/vulnerable/${MODEL_NAME}/dp${DP_EPSILON}_lambda${MAX_LAMBDA}to0.1_alpha${ALPHA}_merged/checkpoint-${STEP}"
                SAVE_PATH="data/vulnerability/privsyn/${MODEL_NAME}/codeonly/private_syndata_55k_dp${DP_EPSILON}_lambda${MAX_LAMBDA}to0.1_alpha${ALPHA}_datasize${DATA_SIZE}.jsonl"

                CUDA_VISIBLE_DEVICES=2,3 python data/vulnerability/privsyn/generate.py \
                                                --ckpt "$CKPT" \
                                                --save_path "$SAVE_PATH" 
            done             
        done             
    done
done

exit 0